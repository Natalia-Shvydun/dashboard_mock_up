<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Transaction Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
        sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background-color: #f5f5f5;
      color: #333333;
      padding: 20px;
      line-height: 1.5;
    }

    .dashboard {
      max-width: 1400px;
      margin: 0 auto;
      background-color: transparent;
      padding: 0;
    }

    /* Dashboard Header */
    .dashboard-header {
      margin-bottom: 24px;
      padding: 0;
      border-bottom: none;
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .owner {
      font-size: 13px;
      color: #666666;
      font-weight: 400;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .refresh-time {
      font-size: 12px;
      color: #999999;
      font-weight: 400;
    }

    .header-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-title h1 {
      font-size: 28px;
      font-weight: 600;
      color: #333333;
      letter-spacing: 0;
    }

    .title-actions {
      display: flex;
      gap: 4px;
    }

    .icon-button {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 18px;
      padding: 6px;
      opacity: 0.6;
      transition: opacity 0.2s;
      color: #666666;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .icon-button:hover {
      opacity: 1;
      background-color: #f5f5f5;
    }

    /* Filters */
    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-bottom: 24px;
      padding: 16px 20px;
      background-color: #ffffff;
      border-radius: 6px;
      border: 1px solid #e0e0e0;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-width: 220px;
    }

    .filter-group label {
      font-size: 12px;
      font-weight: 500;
      color: #666666;
      text-transform: none;
      letter-spacing: 0;
    }

    .filter-select {
      padding: 8px 12px;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      font-size: 13px;
      background-color: white;
      cursor: pointer;
      color: #333333;
      transition: border-color 0.2s;
    }

    .filter-select:hover {
      border-color: #d0d0d0;
    }

    .filter-select:focus {
      outline: none;
      border-color: #1976d2;
      box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.1);
    }

    .toggle-buttons {
      display: flex;
      gap: 0;
      border: 1px solid #dadce0;
      border-radius: 4px;
      overflow: hidden;
      background-color: white;
    }

    .toggle-button {
      padding: 8px 20px;
      border: none;
      background-color: transparent;
      cursor: pointer;
      font-size: 13px;
      transition: background-color 0.2s;
      color: #666666;
      font-weight: 500;
    }

    .toggle-button.active {
      background-color: #1976d2;
      color: white;
    }

    .toggle-button:not(.active):hover {
      background-color: #f5f5f5;
    }

    /* Discover Section */
    .discover-section {
      margin-bottom: 24px;
    }

    .section-header {
      margin-bottom: 16px;
    }

    .section-header h2 {
      font-size: 20px;
      font-weight: 600;
      color: #333333;
      margin-bottom: 8px;
      letter-spacing: 0;
    }

    .section-subtitle h3 {
      font-size: 16px;
      font-weight: 600;
      color: #333333;
      margin-bottom: 4px;
    }

    .section-subtitle p {
      font-size: 13px;
      color: #666666;
      line-height: 1.5;
    }

    .discover-content {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 16px;
    }

    .chart-container {
      background-color: #ffffff;
      padding: 20px;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }

    .apv-chart {
      width: 100%;
      height: 320px;
    }

    /* Narrative Box */
    .narrative-box {
      background-color: #ffffff;
      padding: 16px;
      border-radius: 6px;
      border: 1px solid #e0e0e0;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }

    .narrative-headline {
      font-size: 14px;
      font-weight: 600;
      color: #333333;
      margin-bottom: 10px;
    }

    .narrative-content {
      font-size: 13px;
      color: #666666;
      line-height: 1.6;
    }

    .narrative-content p {
      margin-bottom: 10px;
    }

    .narrative-content p:last-child {
      margin-bottom: 0;
    }

    /* Channel Table */
    .channel-table-section {
      margin-bottom: 24px;
    }

    .channel-table-section .section-header {
      margin-bottom: 16px;
    }

    .channel-table-section .section-header h2 {
      font-size: 20px;
      font-weight: 600;
      color: #333333;
      margin-bottom: 8px;
      letter-spacing: 0;
    }

    .section-link {
      font-size: 13px;
      color: #666666;
    }

    .section-link a {
      color: #1976d2;
      text-decoration: none;
    }

    .section-link a:hover {
      text-decoration: underline;
    }

    .table-container {
      overflow-x: auto;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      background-color: #ffffff;
    }

    .channel-table {
      width: 100%;
      border-collapse: collapse;
      background-color: #ffffff;
      font-size: 13px;
    }

    .channel-table thead {
      background-color: #f5f5f5;
    }

    .channel-table th {
      padding: 12px 14px;
      text-align: left;
      font-weight: 600;
      color: #333333;
      border-bottom: 1px solid #e0e0e0;
      white-space: nowrap;
      font-size: 12px;
      text-transform: none;
      letter-spacing: 0;
    }

    .channel-table th.sortable {
      cursor: pointer;
      user-select: none;
    }

    .sort-arrow {
      margin-left: 4px;
      opacity: 0.5;
      font-size: 12px;
    }

    .channel-table td {
      padding: 10px 14px;
      border-bottom: 1px solid #f0f0f0;
      color: #333333;
      text-align: right;
    }

    .channel-table tbody tr:nth-child(even) {
      background-color: #fafafa;
    }

    .channel-table tbody tr:hover {
      background-color: #f5f5f5;
    }

    .channel-name {
      font-weight: 400;
      color: #333333;
      text-align: left;
    }

    .change-cell {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .change-bar-container {
      flex: 1;
      height: 20px;
      background-color: #f0f0f0;
      border-radius: 2px;
      overflow: hidden;
      min-width: 60px;
    }

    .change-bar {
      height: 100%;
      border-radius: 2px;
      transition: width 0.3s;
    }

    .change-bar.positive {
      background-color: #4285f4;
    }

    .change-bar.negative {
      background-color: #ff9800;
    }

    .change-value {
      font-weight: 500;
      min-width: 50px;
      text-align: right;
      font-size: 13px;
    }

    .change-value.positive {
      color: #1976d2;
    }

    .change-value.negative {
      color: #f57c00;
    }

    .positive {
      color: #1976d2;
    }

    .negative {
      color: #f57c00;
    }

    /* Conditional formatting for table cells */
    .cell-positive {
      background-color: #e3f2fd !important;
    }

    .cell-negative {
      background-color: #fff3e0 !important;
    }

    /* Swimlane */
    .swimlane {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 16px;
      margin-bottom: 24px;
      align-items: start;
    }

    .metric-card {
      background-color: #ffffff;
      padding: 20px;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      text-align: center;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .metric-name {
      font-size: 13px;
      color: #666666;
      margin-bottom: 12px;
      font-weight: 400;
      height: 44px;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      text-align: center;
      line-height: 1.3;
    }

    .metric-values {
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: center;
      justify-content: flex-start;
    }

    .metric-main-value {
      font-size: 32px;
      font-weight: 600;
      color: #333333;
      line-height: 1;
      height: 38px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      white-space: nowrap;
      padding: 0;
      margin: 0;
      font-variant-numeric: tabular-nums;
    }

    .metric-comparison {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      justify-content: center;
      white-space: nowrap;
    }

    .metric-yoy {
      color: #666666;
    }

    .metric-change {
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 2px;
    }

    .metric-change.positive {
      color: #0f9d58;
    }

    .metric-change.positive::before {
      content: '‚ñ≤';
      font-size: 10px;
    }

    .metric-change.negative {
      color: #ea4335;
    }

    .metric-change.negative::before {
      content: '‚ñº';
      font-size: 10px;
    }

    @media (max-width: 1024px) {
      .discover-content {
        grid-template-columns: 1fr;
      }
      .swimlane {
        grid-template-columns: repeat(3, 1fr);
      }
      .charts-row {
        grid-template-columns: 1fr;
      }
      .charts-row-four {
        grid-template-columns: repeat(2, 1fr);
      }
      .charts-row-checkout {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 640px) {
      .swimlane {
        grid-template-columns: 1fr;
      }
      .charts-row-four {
        grid-template-columns: 1fr;
      }
      .charts-row-checkout {
        grid-template-columns: 1fr;
      }
    }

    /* Side-by-side charts */
    .charts-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 24px;
    }

    .charts-row-three {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }

    .charts-row-four {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }

    .charts-row-checkout {
      display: grid;
      grid-template-columns: 1fr 0.8fr 0.8fr 2.4fr;
      gap: 16px;
      margin-bottom: 24px;
    }

    /* Vertical funnel - Looker style (inverted trapezoid) */
    .funnel-container {
      display: flex;
      flex-direction: column;
      gap: 0;
      padding: 20px 0;
      min-height: 400px;
      align-items: flex-start;
    }

    .funnel-row {
      display: flex;
      align-items: center;
      gap: 16px;
      position: relative;
      width: 100%;
      margin-bottom: 0;
    }

    .funnel-label {
      min-width: 220px;
      font-size: 14px;
      font-weight: 400;
      color: #333333;
      text-align: left;
      padding-right: 16px;
      display: flex;
      align-items: center;
      height: 50px;
    }

    .funnel-bar-container {
      flex: 1;
      position: relative;
      display: flex;
      align-items: center;
      height: 50px;
      max-width: 600px;
    }

    .funnel-bar {
      height: 50px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      color: white;
      font-weight: 500;
      font-size: 14px;
      clip-path: polygon(0 0, 100% 0, calc(100% - 12px) 100%, 12px 100%);
      -webkit-clip-path: polygon(0 0, 100% 0, calc(100% - 12px) 100%, 12px 100%);
    }

    .funnel-bar-percentage {
      font-size: 15px;
      font-weight: 600;
      white-space: nowrap;
    }

    .funnel-bar-count {
      font-size: 14px;
      font-weight: 500;
      margin-left: auto;
      padding-left: 16px;
      white-space: nowrap;
    }

    .funnel-yoy-info {
      min-width: 180px;
      font-size: 12px;
      color: #666666;
      padding-left: 16px;
      text-align: left;
    }

    .funnel-yoy-change {
      font-weight: 500;
      margin-left: 4px;
    }

    .funnel-yoy-change.positive {
      color: #0f9d58;
    }

    .funnel-yoy-change.negative {
      color: #ea4335;
    }

    /* Stacked vertical chart */
    .stacked-chart-container {
      padding: 20px;
    }

    /* Text metrics */
    .text-metrics-container {
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .text-metric-item {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .text-metric-label {
      font-size: 13px;
      color: #666666;
      font-weight: 400;
    }

    .text-metric-value {
      font-size: 28px;
      font-weight: 600;
      color: #333333;
    }

    .text-metric-yoy {
      font-size: 12px;
      color: #666666;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .text-metric-change {
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 2px;
    }

    .text-metric-change.positive {
      color: #0f9d58;
    }

    .text-metric-change.positive::before {
      content: '‚ñ≤';
      font-size: 10px;
    }

    .text-metric-change.negative {
      color: #ea4335;
    }

    .text-metric-change.negative::before {
      content: '‚ñº';
      font-size: 10px;
    }

    /* Countries table */
    .countries-table-container {
      overflow-x: auto;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      background-color: #ffffff;
      margin-bottom: 24px;
    }

    .countries-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    .countries-table thead {
      background-color: #f5f5f5;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .countries-table th {
      padding: 12px 10px;
      text-align: left;
      font-weight: 600;
      color: #333333;
      border-bottom: 1px solid #e0e0e0;
      white-space: nowrap;
      font-size: 12px;
      text-transform: none;
      letter-spacing: 0;
    }

    .countries-table td {
      padding: 10px;
      border-bottom: 1px solid #f0f0f0;
      color: #333333;
      text-align: right;
    }

    .countries-table tbody tr:nth-child(even) {
      background-color: #fafafa;
    }

    .countries-table tbody tr:hover {
      background-color: #f5f5f5;
    }

    .country-name {
      font-weight: 400;
      text-align: left;
    }

    /* Table bar visualization */
    .table-bar-cell {
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 120px;
    }

    .table-bar-container {
      flex: 1;
      height: 20px;
      background-color: #f0f0f0;
      border-radius: 2px;
      overflow: hidden;
      position: relative;
    }

    .table-bar-fill {
      height: 100%;
      background-color: #4285f4;
      border-radius: 2px;
      transition: width 0.3s ease;
    }

    .table-bar-value {
      min-width: 60px;
      text-align: right;
      font-size: 13px;
      color: #333333;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    
    // Wait for Chart.js to load
    if (typeof Chart === 'undefined') {
      console.warn('Chart.js is loading...');
    }

    // Main metrics swimlane (last week vs YoY) - 6 metrics
    const mainMetrics = [
      {
        name: 'Absolute number of checkouts',
        lastWeek: 850000,
        lastYear: 820000,
        change: 3.7,
        isNumber: true
      },
      {
        name: 'Checkout-to-booking conversion rate',
        lastWeek: 57.0,
        lastYear: 55.2,
        change: 3.3
      },
      {
        name: 'Checkout-to-payment page conversion rate',
        lastWeek: 75.0,
        lastYear: 74.2,
        change: 1.1
      },
      {
        name: 'Payment page-to-booking conversion rate',
        lastWeek: 76.0,
        lastYear: 74.5,
        change: 2.0
      },
      {
        name: 'Payment costs as % of GMV',
        lastWeek: 1.2,
        lastYear: 1.3,
        change: -7.7
      },
      {
        name: 'Transaction End-to-End Success Rate',
        lastWeek: 99.2,
        lastYear: 98.9,
        change: 0.3
      }
    ];

    // Checkout-to-booking conversion rate (L12W + YoY)
    const checkoutToBookingData = [
      { week: 'Nov 10', lastYear: 55.2, thisYear: 56.8 },
      { week: 'Nov 17', lastYear: 55.1, thisYear: 55.9 },
      { week: 'Nov 24', lastYear: 55.7, thisYear: 57.2 },
      { week: 'Dec 1', lastYear: 55.4, thisYear: 56.3 },
      { week: 'Dec 8', lastYear: 56.3, thisYear: 57.6 },
      { week: 'Dec 15', lastYear: 55.9, thisYear: 56.1 },
      { week: 'Dec 22', lastYear: 56.5, thisYear: 58.2 },
      { week: 'Dec 29', lastYear: 55.8, thisYear: 57.1 },
      { week: 'Jan 5', lastYear: 56.2, thisYear: 57.9 },
      { week: 'Jan 12', lastYear: 55.6, thisYear: 56.4 },
      { week: 'Jan 19', lastYear: 56.1, thisYear: 57.5 },
      { week: 'Jan 26', lastYear: 55.3, thisYear: 56.7 },
    ];

    // Check availability to checkout breakdown
    const checkAvailabilityToCheckoutData = [
      { week: 'Nov 10', checkAvailToActionLY: 21.5, checkAvailToActionTY: 22.8, cartToCheckoutLY: 74.5, cartToCheckoutTY: 75.9 },
      { week: 'Nov 17', checkAvailToActionLY: 21.2, checkAvailToActionTY: 21.9, cartToCheckoutLY: 74.2, cartToCheckoutTY: 74.6 },
      { week: 'Nov 24', checkAvailToActionLY: 22.3, checkAvailToActionTY: 23.1, cartToCheckoutLY: 75.1, cartToCheckoutTY: 76.3 },
      { week: 'Dec 1', checkAvailToActionLY: 21.9, checkAvailToActionTY: 22.4, cartToCheckoutLY: 74.8, cartToCheckoutTY: 75.2 },
      { week: 'Dec 8', checkAvailToActionLY: 22.6, checkAvailToActionTY: 23.3, cartToCheckoutLY: 75.7, cartToCheckoutTY: 76.5 },
      { week: 'Dec 15', checkAvailToActionLY: 22.1, checkAvailToActionTY: 22.7, cartToCheckoutLY: 75.0, cartToCheckoutTY: 75.4 },
      { week: 'Dec 22', checkAvailToActionLY: 23.2, checkAvailToActionTY: 24.0, cartToCheckoutLY: 76.1, cartToCheckoutTY: 77.2 },
      { week: 'Dec 29', checkAvailToActionLY: 22.4, checkAvailToActionTY: 23.1, cartToCheckoutLY: 75.3, cartToCheckoutTY: 76.1 },
      { week: 'Jan 5', checkAvailToActionLY: 22.8, checkAvailToActionTY: 23.6, cartToCheckoutLY: 75.9, cartToCheckoutTY: 76.7 },
      { week: 'Jan 12', checkAvailToActionLY: 21.7, checkAvailToActionTY: 22.3, cartToCheckoutLY: 74.6, cartToCheckoutTY: 75.1 },
      { week: 'Jan 19', checkAvailToActionLY: 22.5, checkAvailToActionTY: 23.2, cartToCheckoutLY: 75.5, cartToCheckoutTY: 76.4 },
      { week: 'Jan 26', checkAvailToActionLY: 21.8, checkAvailToActionTY: 22.5, cartToCheckoutLY: 74.9, cartToCheckoutTY: 75.6 },
    ];

    // Payment page-to-booking conversion rate breakdown
    const paymentPageToBookingBreakdownData = [
      { week: 'Nov 10', paymentInitiationLY: 79.5, paymentInitiationTY: 80.8, paymentSuccessLY: 96.5, paymentSuccessTY: 97.8 },
      { week: 'Nov 17', paymentInitiationLY: 79.2, paymentInitiationTY: 79.9, paymentSuccessLY: 96.2, paymentSuccessTY: 96.7 },
      { week: 'Nov 24', paymentInitiationLY: 80.3, paymentInitiationTY: 81.1, paymentSuccessLY: 97.1, paymentSuccessTY: 98.2 },
      { week: 'Dec 1', paymentInitiationLY: 79.8, paymentInitiationTY: 80.4, paymentSuccessLY: 96.7, paymentSuccessTY: 97.3 },
      { week: 'Dec 8', paymentInitiationLY: 80.6, paymentInitiationTY: 81.3, paymentSuccessLY: 97.4, paymentSuccessTY: 98.5 },
      { week: 'Dec 15', paymentInitiationLY: 79.9, paymentInitiationTY: 80.6, paymentSuccessLY: 96.8, paymentSuccessTY: 97.5 },
      { week: 'Dec 22', paymentInitiationLY: 81.2, paymentInitiationTY: 82.0, paymentSuccessLY: 98.0, paymentSuccessTY: 98.8 },
      { week: 'Dec 29', paymentInitiationLY: 80.1, paymentInitiationTY: 80.9, paymentSuccessLY: 97.0, paymentSuccessTY: 97.9 },
      { week: 'Jan 5', paymentInitiationLY: 80.7, paymentInitiationTY: 81.5, paymentSuccessLY: 97.6, paymentSuccessTY: 98.6 },
      { week: 'Jan 12', paymentInitiationLY: 79.6, paymentInitiationTY: 80.2, paymentSuccessLY: 96.5, paymentSuccessTY: 97.1 },
      { week: 'Jan 19', paymentInitiationLY: 80.4, paymentInitiationTY: 81.2, paymentSuccessLY: 97.3, paymentSuccessTY: 98.3 },
      { week: 'Jan 26', paymentInitiationLY: 79.7, paymentInitiationTY: 80.5, paymentSuccessLY: 96.6, paymentSuccessTY: 97.4 },
    ];

    // Vertical funnel data (last 7 days + YoY) - with absolute numbers
    const funnelData = {
      last7Days: {
        checkAvailability: { pct: 100, count: 4000000 },
        checkout: { pct: 22, count: 880000 },
        paymentPage: { pct: 16.5, count: 660000 },
        paymentInitiation: { pct: 13.2, count: 528000 },
        booking: { pct: 7.5, count: 300000 }
      },
      lastYear: {
        checkAvailability: { pct: 100, count: 3800000 },
        checkout: { pct: 21.5, count: 817000 },
        paymentPage: { pct: 16.0, count: 608000 },
        paymentInitiation: { pct: 12.8, count: 486400 },
        booking: { pct: 7.2, count: 273600 }
      }
    };

    // Transaction End-to-End Success Rate (L12W + YoY) - high numbers around 99%
    const transactionSuccessRateData = [
      { week: 'Nov 10', lastYear: 98.86, thisYear: 98.95 },
      { week: 'Nov 17', lastYear: 98.82, thisYear: 98.88 },
      { week: 'Nov 24', lastYear: 98.93, thisYear: 99.01 },
      { week: 'Dec 1', lastYear: 98.89, thisYear: 98.97 },
      { week: 'Dec 8', lastYear: 98.96, thisYear: 99.04 },
      { week: 'Dec 15', lastYear: 98.91, thisYear: 98.99 },
      { week: 'Dec 22', lastYear: 99.00, thisYear: 99.07 },
      { week: 'Dec 29', lastYear: 98.94, thisYear: 99.02 },
      { week: 'Jan 5', lastYear: 98.98, thisYear: 99.05 },
      { week: 'Jan 12', lastYear: 98.87, thisYear: 98.93 },
      { week: 'Jan 19', lastYear: 98.95, thisYear: 99.00 },
      { week: 'Jan 26', lastYear: 98.90, thisYear: 98.96 },
    ];

    // Checkout breakdown - Split by Add to cart / Book now (last 7 days + YoY)
    const checkoutSplitData = {
      last7Days: { addToCart: 65.2, bookNow: 34.8 },
      lastYear: { addToCart: 63.5, bookNow: 36.5 }
    };

    // Split by login type (last 7 days + YoY)
    const loginTypeData = {
      last7Days: { guest: 57.7, email: 28.3, social: 14.0 },
      lastYear: { guest: 61.1, email: 25.2, social: 13.7 }
    };

    // Share of shopping carts with coupon/cash gift code applied (L12W + YoY)
    const couponUsageData = [
      { week: 'Nov 10', lastYear: 12.6, thisYear: 13.8 },
      { week: 'Nov 17', lastYear: 12.4, thisYear: 12.9 },
      { week: 'Nov 24', lastYear: 13.2, thisYear: 14.1 },
      { week: 'Dec 1', lastYear: 12.8, thisYear: 13.5 },
      { week: 'Dec 8', lastYear: 13.5, thisYear: 14.3 },
      { week: 'Dec 15', lastYear: 12.9, thisYear: 13.2 },
      { week: 'Dec 22', lastYear: 13.7, thisYear: 14.6 },
      { week: 'Dec 29', lastYear: 13.1, thisYear: 13.9 },
      { week: 'Jan 5', lastYear: 13.6, thisYear: 14.4 },
      { week: 'Jan 12', lastYear: 12.7, thisYear: 13.4 },
      { week: 'Jan 19', lastYear: 13.3, thisYear: 14.2 },
      { week: 'Jan 26', lastYear: 12.5, thisYear: 13.3 },
    ];

    // Text metrics for checkout breakdown
    const checkoutTextMetrics = {
      loggedInCheckouts: { last7Days: 42.3, lastYear: 38.9, change: 8.7 },
      createdAccounts: { last7Days: 18.5, lastYear: 16.2, change: 14.2 }
    };

    // Payment terms split (Pay now / Pay later) - L12W + YoY
    const paymentTermsData = [
      { week: 'Nov 10', payNowLY: 78.5, payNowTY: 79.2, payLaterLY: 21.5, payLaterTY: 20.8 },
      { week: 'Nov 17', payNowLY: 78.7, payNowTY: 78.9, payLaterLY: 21.3, payLaterTY: 21.1 },
      { week: 'Nov 24', payNowLY: 78.9, payNowTY: 79.5, payLaterLY: 21.1, payLaterTY: 20.5 },
      { week: 'Dec 1', payNowLY: 79.1, payNowTY: 79.7, payLaterLY: 20.9, payLaterTY: 20.3 },
      { week: 'Dec 8', payNowLY: 79.3, payNowTY: 79.0, payLaterLY: 20.7, payLaterTY: 21.0 },
      { week: 'Dec 15', payNowLY: 79.5, payNowTY: 80.1, payLaterLY: 20.5, payLaterTY: 19.9 },
      { week: 'Dec 22', payNowLY: 79.7, payNowTY: 79.4, payLaterLY: 20.3, payLaterTY: 20.6 },
      { week: 'Dec 29', payNowLY: 79.9, payNowTY: 80.4, payLaterLY: 20.1, payLaterTY: 19.6 },
      { week: 'Jan 5', payNowLY: 79.8, payNowTY: 80.2, payLaterLY: 20.2, payLaterTY: 19.8 },
      { week: 'Jan 12', payNowLY: 79.6, payNowTY: 79.3, payLaterLY: 20.4, payLaterTY: 20.7 },
      { week: 'Jan 19', payNowLY: 79.4, payNowTY: 79.9, payLaterLY: 20.6, payLaterTY: 20.1 },
      { week: 'Jan 26', payNowLY: 78.6, payNowTY: 79.1, payLaterLY: 21.4, payLaterTY: 20.9 },
    ];

    // Payment method groups split - L12W + YoY
    const paymentMethodsData = [
      { week: 'Nov 10', creditCardsLY: 45.2, creditCardsTY: 44.8, mobileWalletsLY: 18.5, mobileWalletsTY: 19.2, paypalLY: 22.3, paypalTY: 21.8, klarnaLY: 8.5, klarnaTY: 8.9, localAPMsLY: 5.5, localAPMsTY: 5.3 },
      { week: 'Nov 17', creditCardsLY: 45.4, creditCardsTY: 45.1, mobileWalletsLY: 18.6, mobileWalletsTY: 18.9, paypalLY: 22.4, paypalTY: 22.1, klarnaLY: 8.6, klarnaTY: 8.7, localAPMsLY: 5.0, localAPMsTY: 5.2 },
      { week: 'Nov 24', creditCardsLY: 45.6, creditCardsTY: 45.3, mobileWalletsLY: 18.7, mobileWalletsTY: 19.4, paypalLY: 22.5, paypalTY: 22.0, klarnaLY: 8.7, klarnaTY: 9.0, localAPMsLY: 4.5, localAPMsTY: 4.3 },
      { week: 'Dec 1', creditCardsLY: 45.8, creditCardsTY: 45.5, mobileWalletsLY: 18.8, mobileWalletsTY: 19.6, paypalLY: 22.6, paypalTY: 22.2, klarnaLY: 8.8, klarnaTY: 9.1, localAPMsLY: 4.0, localAPMsTY: 3.6 },
      { week: 'Dec 8', creditCardsLY: 46.0, creditCardsTY: 45.2, mobileWalletsLY: 18.9, mobileWalletsTY: 19.1, paypalLY: 22.7, paypalTY: 22.4, klarnaLY: 8.9, klarnaTY: 8.8, localAPMsLY: 3.5, localAPMsTY: 4.5 },
      { week: 'Dec 15', creditCardsLY: 46.2, creditCardsTY: 45.7, mobileWalletsLY: 19.0, mobileWalletsTY: 19.8, paypalLY: 22.8, paypalTY: 22.3, klarnaLY: 9.0, klarnaTY: 9.3, localAPMsLY: 3.0, localAPMsTY: 2.9 },
      { week: 'Dec 22', creditCardsLY: 46.4, creditCardsTY: 45.4, mobileWalletsLY: 19.1, mobileWalletsTY: 19.3, paypalLY: 22.9, paypalTY: 22.6, klarnaLY: 9.1, klarnaTY: 8.9, localAPMsLY: 2.5, localAPMsTY: 3.8 },
      { week: 'Dec 29', creditCardsLY: 46.6, creditCardsTY: 45.9, mobileWalletsLY: 19.2, mobileWalletsTY: 20.0, paypalLY: 23.0, paypalTY: 22.5, klarnaLY: 9.2, klarnaTY: 9.5, localAPMsLY: 2.0, localAPMsTY: 2.1 },
      { week: 'Jan 5', creditCardsLY: 46.5, creditCardsTY: 45.8, mobileWalletsLY: 19.2, mobileWalletsTY: 19.9, paypalLY: 23.0, paypalTY: 22.4, klarnaLY: 9.2, klarnaTY: 9.4, localAPMsLY: 2.1, localAPMsTY: 2.5 },
      { week: 'Jan 12', creditCardsLY: 46.3, creditCardsTY: 45.6, mobileWalletsLY: 19.1, mobileWalletsTY: 19.2, paypalLY: 22.9, paypalTY: 22.7, klarnaLY: 9.1, klarnaTY: 8.7, localAPMsLY: 2.6, localAPMsTY: 3.8 },
      { week: 'Jan 19', creditCardsLY: 46.1, creditCardsTY: 45.7, mobileWalletsLY: 19.0, mobileWalletsTY: 19.5, paypalLY: 22.8, paypalTY: 22.3, klarnaLY: 9.0, klarnaTY: 9.2, localAPMsLY: 3.1, localAPMsTY: 3.3 },
      { week: 'Jan 26', creditCardsLY: 45.3, creditCardsTY: 45.0, mobileWalletsLY: 18.6, mobileWalletsTY: 19.1, paypalLY: 22.5, paypalTY: 22.2, klarnaLY: 8.6, klarnaTY: 8.9, localAPMsLY: 5.0, localAPMsTY: 4.8 },
    ];

    // Payment metrics swimlane (last week vs YoY) - 5 metrics
    const paymentMetrics = [
      {
        name: 'Payment attempt success rate',
        lastWeek: 83.0,
        lastYear: 81.5,
        change: 1.8
      },
      {
        name: 'Share of customers with payment retries',
        lastWeek: 18.5,
        lastYear: 19.8,
        change: -6.6
      },
      {
        name: 'Fraud block rate',
        lastWeek: 1.2,
        lastYear: 1.5,
        change: -20.0
      },
      {
        name: 'Dispute rate',
        lastWeek: 0.8,
        lastYear: 0.9,
        change: -11.1
      },
      {
        name: 'Refunds rate',
        lastWeek: 3.5,
        lastYear: 3.8,
        change: -7.9
      },
      {
        name: '% of countries with payment‚Üíbooking conversion below 80%',
        lastWeek: 12.5,
        lastYear: 15.2,
        change: -17.8
      }
    ];

    // Processor performance data - 5 processors: Adyen, Checkout, JPMC, PayPal, Klarna
    const processorPerformanceData = {
      successRate: [
        { week: 'Nov 10', adyenTY: 97.5, checkoutTY: 97.1, jpmcTY: 96.8, paypalTY: 96.2, klarnaTY: 95.9 },
        { week: 'Nov 17', adyenTY: 97.2, checkoutTY: 96.7, jpmcTY: 96.5, paypalTY: 96.0, klarnaTY: 95.4 },
        { week: 'Nov 24', adyenTY: 97.7, checkoutTY: 97.3, jpmcTY: 97.0, paypalTY: 96.5, klarnaTY: 96.1 },
        { week: 'Dec 1', adyenTY: 97.8, checkoutTY: 97.4, jpmcTY: 97.2, paypalTY: 96.7, klarnaTY: 96.2 },
        { week: 'Dec 8', adyenTY: 97.4, checkoutTY: 97.0, jpmcTY: 96.7, paypalTY: 96.1, klarnaTY: 95.7 },
        { week: 'Dec 15', adyenTY: 98.0, checkoutTY: 97.6, jpmcTY: 97.3, paypalTY: 96.8, klarnaTY: 96.4 },
        { week: 'Dec 22', adyenTY: 97.6, checkoutTY: 97.2, jpmcTY: 96.9, paypalTY: 96.4, klarnaTY: 95.9 },
        { week: 'Dec 29', adyenTY: 98.1, checkoutTY: 97.8, jpmcTY: 97.5, paypalTY: 97.0, klarnaTY: 96.6 },
        { week: 'Jan 5', adyenTY: 98.0, checkoutTY: 97.7, jpmcTY: 97.4, paypalTY: 96.9, klarnaTY: 96.5 },
        { week: 'Jan 12', adyenTY: 97.5, checkoutTY: 97.1, jpmcTY: 96.8, paypalTY: 96.3, klarnaTY: 95.8 },
        { week: 'Jan 19', adyenTY: 97.9, checkoutTY: 97.5, jpmcTY: 97.2, paypalTY: 96.7, klarnaTY: 96.2 },
        { week: 'Jan 26', adyenTY: 97.6, checkoutTY: 97.2, jpmcTY: 96.9, paypalTY: 96.4, klarnaTY: 95.9 },
      ],
      costs: [
        { week: 'Nov 10', adyenTY: 2.4, checkoutTY: 2.7, jpmcTY: 2.9, paypalTY: 3.1, klarnaTY: 3.3 },
        { week: 'Nov 17', adyenTY: 2.42, checkoutTY: 2.72, jpmcTY: 2.92, paypalTY: 3.12, klarnaTY: 3.32 },
        { week: 'Nov 24', adyenTY: 2.38, checkoutTY: 2.68, jpmcTY: 2.88, paypalTY: 3.08, klarnaTY: 3.28 },
        { week: 'Dec 1', adyenTY: 2.36, checkoutTY: 2.66, jpmcTY: 2.86, paypalTY: 3.06, klarnaTY: 3.26 },
        { week: 'Dec 8', adyenTY: 2.41, checkoutTY: 2.71, jpmcTY: 2.91, paypalTY: 3.11, klarnaTY: 3.31 },
        { week: 'Dec 15', adyenTY: 2.35, checkoutTY: 2.65, jpmcTY: 2.85, paypalTY: 3.05, klarnaTY: 3.25 },
        { week: 'Dec 22', adyenTY: 2.39, checkoutTY: 2.69, jpmcTY: 2.89, paypalTY: 3.09, klarnaTY: 3.29 },
        { week: 'Dec 29', adyenTY: 2.33, checkoutTY: 2.63, jpmcTY: 2.83, paypalTY: 3.03, klarnaTY: 3.23 },
        { week: 'Jan 5', adyenTY: 2.34, checkoutTY: 2.64, jpmcTY: 2.84, paypalTY: 3.04, klarnaTY: 3.24 },
        { week: 'Jan 12', adyenTY: 2.37, checkoutTY: 2.67, jpmcTY: 2.87, paypalTY: 3.07, klarnaTY: 3.27 },
        { week: 'Jan 19', adyenTY: 2.32, checkoutTY: 2.62, jpmcTY: 2.82, paypalTY: 3.02, klarnaTY: 3.22 },
        { week: 'Jan 26', adyenTY: 2.38, checkoutTY: 2.68, jpmcTY: 2.88, paypalTY: 3.08, klarnaTY: 3.28 },
      ]
    };

    // Top 20 countries data (last 7 days)
    const topCountriesData = [
      { country: 'United States', paymentPageVisits: 2450000, paymentInitiationRate: 94.2, paymentMethods: 5, localAPMsPct: 12.5, paymentSuccessRate: 97.8, attemptSuccessRate: 96.5, retriesPct: 18.2, fraudBlockRate: 1.1, gmvShare: 28.5, costsPct: 2.6, disputeRate: 0.7, refundsRate: 3.2 },
      { country: 'United Kingdom', paymentPageVisits: 1890000, paymentInitiationRate: 95.1, paymentMethods: 4, localAPMsPct: 8.3, paymentSuccessRate: 98.2, attemptSuccessRate: 97.1, retriesPct: 16.8, fraudBlockRate: 0.9, gmvShare: 18.2, costsPct: 2.4, disputeRate: 0.6, refundsRate: 2.9 },
      { country: 'Germany', paymentPageVisits: 1650000, paymentInitiationRate: 93.8, paymentMethods: 6, localAPMsPct: 22.4, paymentSuccessRate: 97.5, attemptSuccessRate: 96.2, retriesPct: 19.5, fraudBlockRate: 1.3, gmvShare: 15.8, costsPct: 2.9, disputeRate: 0.8, refundsRate: 3.5 },
      { country: 'France', paymentPageVisits: 1420000, paymentInitiationRate: 94.5, paymentMethods: 5, localAPMsPct: 15.2, paymentSuccessRate: 98.0, attemptSuccessRate: 96.8, retriesPct: 17.3, fraudBlockRate: 1.0, gmvShare: 13.5, costsPct: 2.7, disputeRate: 0.7, refundsRate: 3.1 },
      { country: 'Italy', paymentPageVisits: 1280000, paymentInitiationRate: 92.9, paymentMethods: 4, localAPMsPct: 18.7, paymentSuccessRate: 97.2, attemptSuccessRate: 95.8, retriesPct: 20.1, fraudBlockRate: 1.4, gmvShare: 12.1, costsPct: 3.1, disputeRate: 0.9, refundsRate: 3.8 },
      { country: 'Spain', paymentPageVisits: 1150000, paymentInitiationRate: 94.1, paymentMethods: 5, localAPMsPct: 14.6, paymentSuccessRate: 97.6, attemptSuccessRate: 96.3, retriesPct: 18.7, fraudBlockRate: 1.2, gmvShare: 10.9, costsPct: 2.8, disputeRate: 0.8, refundsRate: 3.4 },
      { country: 'Netherlands', paymentPageVisits: 980000, paymentInitiationRate: 95.3, paymentMethods: 4, localAPMsPct: 11.2, paymentSuccessRate: 98.4, attemptSuccessRate: 97.3, retriesPct: 15.9, fraudBlockRate: 0.8, gmvShare: 9.2, costsPct: 2.3, disputeRate: 0.5, refundsRate: 2.7 },
      { country: 'Australia', paymentPageVisits: 920000, paymentInitiationRate: 94.7, paymentMethods: 5, localAPMsPct: 9.8, paymentSuccessRate: 97.9, attemptSuccessRate: 96.6, retriesPct: 17.5, fraudBlockRate: 1.0, gmvShare: 8.7, costsPct: 2.5, disputeRate: 0.6, refundsRate: 3.0 },
      { country: 'Canada', paymentPageVisits: 870000, paymentInitiationRate: 94.0, paymentMethods: 4, localAPMsPct: 7.4, paymentSuccessRate: 97.7, attemptSuccessRate: 96.4, retriesPct: 18.0, fraudBlockRate: 1.1, gmvShare: 8.2, costsPct: 2.6, disputeRate: 0.7, refundsRate: 3.2 },
      { country: 'Switzerland', paymentPageVisits: 760000, paymentInitiationRate: 95.8, paymentMethods: 5, localAPMsPct: 13.1, paymentSuccessRate: 98.6, attemptSuccessRate: 97.5, retriesPct: 15.2, fraudBlockRate: 0.7, gmvShare: 7.1, costsPct: 2.2, disputeRate: 0.5, refundsRate: 2.6 },
      { country: 'Austria', paymentPageVisits: 680000, paymentInitiationRate: 94.3, paymentMethods: 4, localAPMsPct: 16.8, paymentSuccessRate: 97.8, attemptSuccessRate: 96.5, retriesPct: 18.3, fraudBlockRate: 1.1, gmvShare: 6.4, costsPct: 2.7, disputeRate: 0.7, refundsRate: 3.2 },
      { country: 'Belgium', paymentPageVisits: 620000, paymentInitiationRate: 94.9, paymentMethods: 4, localAPMsPct: 12.7, paymentSuccessRate: 98.1, attemptSuccessRate: 96.9, retriesPct: 17.0, fraudBlockRate: 0.9, gmvShare: 5.8, costsPct: 2.5, disputeRate: 0.6, refundsRate: 3.0 },
      { country: 'Sweden', paymentPageVisits: 580000, paymentInitiationRate: 95.5, paymentMethods: 5, localAPMsPct: 19.3, paymentSuccessRate: 98.3, attemptSuccessRate: 97.2, retriesPct: 16.1, fraudBlockRate: 0.8, gmvShare: 5.5, costsPct: 2.4, disputeRate: 0.6, refundsRate: 2.8 },
      { country: 'Norway', paymentPageVisits: 540000, paymentInitiationRate: 95.2, paymentMethods: 4, localAPMsPct: 17.5, paymentSuccessRate: 98.0, attemptSuccessRate: 96.7, retriesPct: 17.2, fraudBlockRate: 0.9, gmvShare: 5.1, costsPct: 2.5, disputeRate: 0.6, refundsRate: 3.0 },
      { country: 'Denmark', paymentPageVisits: 510000, paymentInitiationRate: 95.6, paymentMethods: 4, localAPMsPct: 15.9, paymentSuccessRate: 98.4, attemptSuccessRate: 97.3, retriesPct: 15.8, fraudBlockRate: 0.8, gmvShare: 4.8, costsPct: 2.3, disputeRate: 0.5, refundsRate: 2.7 },
      { country: 'Ireland', paymentPageVisits: 480000, paymentInitiationRate: 94.6, paymentMethods: 4, localAPMsPct: 10.4, paymentSuccessRate: 97.9, attemptSuccessRate: 96.6, retriesPct: 17.6, fraudBlockRate: 1.0, gmvShare: 4.5, costsPct: 2.6, disputeRate: 0.7, refundsRate: 3.1 },
      { country: 'Portugal', paymentPageVisits: 450000, paymentInitiationRate: 93.5, paymentMethods: 4, localAPMsPct: 13.8, paymentSuccessRate: 97.4, attemptSuccessRate: 96.0, retriesPct: 19.2, fraudBlockRate: 1.2, gmvShare: 4.2, costsPct: 2.8, disputeRate: 0.8, refundsRate: 3.5 },
      { country: 'Poland', paymentPageVisits: 420000, paymentInitiationRate: 92.4, paymentMethods: 5, localAPMsPct: 21.6, paymentSuccessRate: 97.1, attemptSuccessRate: 95.6, retriesPct: 20.5, fraudBlockRate: 1.5, gmvShare: 4.0, costsPct: 3.0, disputeRate: 0.9, refundsRate: 3.9 },
      { country: 'Czech Republic', paymentPageVisits: 390000, paymentInitiationRate: 93.1, paymentMethods: 4, localAPMsPct: 20.2, paymentSuccessRate: 97.3, attemptSuccessRate: 95.9, retriesPct: 19.8, fraudBlockRate: 1.3, gmvShare: 3.7, costsPct: 2.9, disputeRate: 0.8, refundsRate: 3.6 },
      { country: 'Greece', paymentPageVisits: 360000, paymentInitiationRate: 92.8, paymentMethods: 3, localAPMsPct: 16.4, paymentSuccessRate: 97.0, attemptSuccessRate: 95.5, retriesPct: 20.8, fraudBlockRate: 1.6, gmvShare: 3.4, costsPct: 3.2, disputeRate: 1.0, refundsRate: 4.1 }
    ];


    function formatNumber(num) {
      return num.toLocaleString();
    }

    function DashboardHeader() {
      return (
        <div className="dashboard-header">
          <div className="header-top">
            <span className="owner">Natalia Shvydun</span>
            <div className="header-actions">
              <span className="refresh-time">just now</span>
              <button className="icon-button">üîÑ</button>
              <button className="icon-button">‚ò∞</button>
            </div>
          </div>
          <div className="header-title">
            <h1>Transaction Cockpit</h1>
            <div className="title-actions">
              <button className="icon-button">‚ù§Ô∏è</button>
              <button className="icon-button">üîó</button>
              <button className="icon-button">üîÑ</button>
            </div>
          </div>
        </div>
      );
    }

    function Filters() {
      return (
        <div className="filters">
          <div className="filter-group">
            <label>Channel Group</label>
            <select className="filter-select">
              <option>is any value</option>
            </select>
          </div>
          <div className="filter-group">
            <label>Channel</label>
            <select className="filter-select">
              <option>is any value</option>
            </select>
          </div>
          <div className="filter-group">
            <label>Platform</label>
            <select className="filter-select">
              <option>is any value</option>
              <option>Desktop</option>
              <option>MWeb</option>
              <option>iOS</option>
              <option>Android</option>
            </select>
          </div>
          <div className="filter-group">
            <label>Customer Type</label>
            <select className="filter-select">
              <option>is any value</option>
              <option>New Customer</option>
              <option>Repeat Customer</option>
            </select>
          </div>
          <div className="filter-group">
            <label>User locale</label>
            <select className="filter-select">
              <option>is any value</option>
            </select>
          </div>
        </div>
      );
    }

    function MainMetricsSwimlane() {
      return (
        <div className="swimlane">
          {mainMetrics.map((metric, index) => (
            <div key={index} className="metric-card">
              <div className="metric-name">{metric.name}</div>
              <div className="metric-values">
                <div className="metric-main-value" style={{ fontVariantNumeric: 'tabular-nums' }}>
                  {metric.isNumber ? formatNumber(metric.lastWeek) : metric.lastWeek.toFixed(1) + '%'}
                </div>
                <div className="metric-comparison">
                  <span className="metric-yoy">
                    YoY: {metric.isNumber ? formatNumber(metric.lastYear) : metric.lastYear.toFixed(1) + '%'}
                  </span>
                  <span className={`metric-change ${metric.change >= 0 ? 'positive' : 'negative'}`}>
                    {metric.change > 0 ? '+' : ''}{metric.change.toFixed(1)}%
                  </span>
                </div>
              </div>
            </div>
          ))}
        </div>
      );
    }

    function createChart(chartRef, chartInstanceRef, data, labels, datasets, yAxisConfig) {
      if (chartRef.current && typeof Chart !== 'undefined') {
        const ctx = chartRef.current.getContext('2d');
        
        if (chartInstanceRef.current) {
          chartInstanceRef.current.destroy();
        }

        chartInstanceRef.current = new Chart(ctx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: datasets
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: true,
                  position: 'bottom',
                  labels: {
                    usePointStyle: true,
                    padding: 20,
                    font: { size: 12, family: "'Roboto', sans-serif" },
                    color: '#333333',
                    boxWidth: 12,
                    boxHeight: 12
                  }
                },
                tooltip: {
                  mode: 'index',
                  intersect: false,
                  backgroundColor: 'rgba(0, 0, 0, 0.8)',
                  padding: 10,
                  titleFont: { size: 12, weight: '500' },
                  bodyFont: { size: 12 },
                  borderColor: 'transparent',
                  borderWidth: 0,
                  cornerRadius: 4,
                  displayColors: true,
                  callbacks: {
                    label: function(context) {
                      return context.dataset.label + ': ' + context.parsed.y.toFixed(1) + '%';
                    }
                  }
                }
              },
            scales: {
              x: {
                title: {
                  display: true,
                  text: 'Session Week (Adjusted to This Year)',
                  font: { size: 12, family: "'Roboto', sans-serif" },
                  color: '#5f6368',
                  padding: { top: 8, bottom: 0 }
                },
                ticks: {
                  font: { size: 12, family: "'Roboto', sans-serif" },
                  color: '#999999',
                  padding: 6
                },
                grid: {
                  color: '#f0f0f0',
                  borderDash: [],
                  drawBorder: false,
                  display: false
                },
                border: {
                  display: false
                }
              },
              y: {
                title: {
                  display: true,
                  text: yAxisConfig.title,
                  font: { size: 12, family: "'Roboto', sans-serif" },
                  color: '#666666',
                  padding: { top: 0, bottom: 8 }
                },
                min: yAxisConfig.min,
                max: yAxisConfig.max,
                ticks: {
                  stepSize: yAxisConfig.stepSize,
                  font: { size: 12, family: "'Roboto', sans-serif" },
                  color: '#999999',
                  padding: 6,
                  callback: function(value) {
                    return value + '%';
                  }
                },
                grid: {
                  color: '#f0f0f0',
                  borderDash: [],
                  drawBorder: false
                },
                border: {
                  display: false
                }
              }
            }
          }
        });
      }
    }

    function CheckoutToBookingChart() {
      const chartRef = useRef(null);
      const chartInstanceRef = useRef(null);

      useEffect(() => {
          const datasets = [
          {
            label: 'Last Year',
            data: checkoutToBookingData.map(d => d.lastYear),
            borderColor: '#fbbc04',
            backgroundColor: 'transparent',
            borderWidth: 2,
            pointRadius: 3,
            pointHoverRadius: 4,
            pointBackgroundColor: '#fbbc04',
            pointBorderColor: '#ffffff',
            pointBorderWidth: 1.5,
            tension: 0
          },
          {
            label: 'This Year',
            data: checkoutToBookingData.map(d => d.thisYear),
            borderColor: '#ea4335',
            backgroundColor: 'transparent',
            borderWidth: 2,
            pointRadius: 3,
            pointHoverRadius: 4,
            pointBackgroundColor: '#ea4335',
            pointBorderColor: '#ffffff',
            pointBorderWidth: 1.5,
            tension: 0
          }
        ];

        createChart(
          chartRef,
          chartInstanceRef,
          checkoutToBookingData,
          checkoutToBookingData.map(d => d.week),
          datasets,
          { title: 'Conversion Rate (%)', min: 54, max: 59, stepSize: 1 }
        );

        return () => {
          if (chartInstanceRef.current) {
            chartInstanceRef.current.destroy();
          }
        };
      }, []);

      return (
        <div className="apv-chart">
          <canvas ref={chartRef}></canvas>
        </div>
      );
    }

    function CheckAvailabilityToCheckoutChart() {
      const chartRef = useRef(null);
      const chartInstanceRef = useRef(null);

      useEffect(() => {
        const datasets = [
          {
            label: 'Check availability ‚Üí Add to cart/Checkout (Last Year)',
            data: checkAvailabilityToCheckoutData.map(d => d.checkAvailToActionLY),
            borderColor: '#fbbc04',
            backgroundColor: 'transparent',
            borderWidth: 2,
            borderDash: [6, 4],
            pointRadius: 2.5,
            pointHoverRadius: 4,
            pointBackgroundColor: '#fbbc04',
            pointBorderColor: '#ffffff',
            pointBorderWidth: 1.5,
            tension: 0
          },
          {
            label: 'Check availability ‚Üí Add to cart/Checkout (This Year)',
            data: checkAvailabilityToCheckoutData.map(d => d.checkAvailToActionTY),
            borderColor: '#ea4335',
            backgroundColor: 'transparent',
            borderWidth: 2,
            pointRadius: 3,
            pointHoverRadius: 4,
            pointBackgroundColor: '#ea4335',
            pointBorderColor: '#ffffff',
            pointBorderWidth: 1.5,
            tension: 0
          },
          {
            label: 'Add to cart ‚Üí Checkout (Last Year)',
            data: checkAvailabilityToCheckoutData.map(d => d.cartToCheckoutLY),
            borderColor: '#fbbc04',
            backgroundColor: 'transparent',
            borderWidth: 2,
            borderDash: [6, 4],
            pointRadius: 2.5,
            pointHoverRadius: 4,
            pointBackgroundColor: '#fbbc04',
            pointBorderColor: '#ffffff',
            pointBorderWidth: 1.5,
            tension: 0
          },
          {
            label: 'Add to cart ‚Üí Checkout (This Year)',
            data: checkAvailabilityToCheckoutData.map(d => d.cartToCheckoutTY),
            borderColor: '#4285f4',
            backgroundColor: 'transparent',
            borderWidth: 2,
            pointRadius: 3,
            pointHoverRadius: 4,
            pointBackgroundColor: '#4285f4',
            pointBorderColor: '#ffffff',
            pointBorderWidth: 1.5,
            tension: 0
          }
        ];

        createChart(
          chartRef,
          chartInstanceRef,
          checkAvailabilityToCheckoutData,
          checkAvailabilityToCheckoutData.map(d => d.week),
          datasets,
          { title: 'Conversion Rate (%)', min: 20, max: 25, stepSize: 1 }
        );

        return () => {
          if (chartInstanceRef.current) {
            chartInstanceRef.current.destroy();
          }
        };
      }, []);

      return (
        <div className="apv-chart">
          <canvas ref={chartRef}></canvas>
        </div>
      );
    }

    function PaymentPageToBookingBreakdownChart() {
      const chartRef = useRef(null);
      const chartInstanceRef = useRef(null);

      useEffect(() => {
        const datasets = [
          {
            label: 'Payment initiation rate (Last Year)',
            data: paymentPageToBookingBreakdownData.map(d => d.paymentInitiationLY),
            borderColor: '#fbbc04',
            backgroundColor: 'transparent',
            borderWidth: 2,
            borderDash: [6, 4],
            pointRadius: 2.5,
            pointHoverRadius: 4,
            pointBackgroundColor: '#fbbc04',
            pointBorderColor: '#ffffff',
            pointBorderWidth: 1.5,
            tension: 0
          },
          {
            label: 'Payment initiation rate (This Year)',
            data: paymentPageToBookingBreakdownData.map(d => d.paymentInitiationTY),
            borderColor: '#ea4335',
            backgroundColor: 'transparent',
            borderWidth: 2,
            pointRadius: 3,
            pointHoverRadius: 4,
            pointBackgroundColor: '#ea4335',
            pointBorderColor: '#ffffff',
            pointBorderWidth: 1.5,
            tension: 0
          },
          {
            label: 'Payment success rate (Last Year)',
            data: paymentPageToBookingBreakdownData.map(d => d.paymentSuccessLY),
            borderColor: '#fbbc04',
            backgroundColor: 'transparent',
            borderWidth: 2,
            borderDash: [6, 4],
            pointRadius: 2.5,
            pointHoverRadius: 4,
            pointBackgroundColor: '#fbbc04',
            pointBorderColor: '#ffffff',
            pointBorderWidth: 1.5,
            tension: 0
          },
          {
            label: 'Payment success rate (This Year)',
            data: paymentPageToBookingBreakdownData.map(d => d.paymentSuccessTY),
            borderColor: '#34a853',
            backgroundColor: 'transparent',
            borderWidth: 2,
            pointRadius: 3,
            pointHoverRadius: 4,
            pointBackgroundColor: '#34a853',
            pointBorderColor: '#ffffff',
            pointBorderWidth: 1.5,
            tension: 0
          }
        ];

        createChart(
          chartRef,
          chartInstanceRef,
          paymentPageToBookingBreakdownData,
          paymentPageToBookingBreakdownData.map(d => d.week),
          datasets,
          { title: 'Conversion Rate (%)', min: 20, max: 97, stepSize: 5 }
        );

        return () => {
          if (chartInstanceRef.current) {
            chartInstanceRef.current.destroy();
          }
        };
      }, []);

      return (
        <div className="apv-chart">
          <canvas ref={chartRef}></canvas>
        </div>
      );
    }

    function VerticalFunnelChart() {
      const steps = [
        { 
          name: 'Check availability', 
          last7Days: funnelData.last7Days.checkAvailability, 
          lastYear: funnelData.lastYear.checkAvailability,
          conversionPct: 100 // Always 100% for first step
        },
        { 
          name: 'Checkout', 
          last7Days: funnelData.last7Days.checkout, 
          lastYear: funnelData.lastYear.checkout,
          conversionPct: (funnelData.last7Days.checkout.pct / funnelData.last7Days.checkAvailability.pct * 100).toFixed(1)
        },
        { 
          name: 'Payment page', 
          last7Days: funnelData.last7Days.paymentPage, 
          lastYear: funnelData.lastYear.paymentPage,
          conversionPct: (funnelData.last7Days.paymentPage.pct / funnelData.last7Days.checkout.pct * 100).toFixed(1)
        },
        { 
          name: 'Payment initiation', 
          last7Days: funnelData.last7Days.paymentInitiation, 
          lastYear: funnelData.lastYear.paymentInitiation,
          conversionPct: (funnelData.last7Days.paymentInitiation.pct / funnelData.last7Days.paymentPage.pct * 100).toFixed(1)
        },
        { 
          name: 'Booking', 
          last7Days: funnelData.last7Days.booking, 
          lastYear: funnelData.lastYear.booking,
          conversionPct: (funnelData.last7Days.booking.pct / funnelData.last7Days.paymentInitiation.pct * 100).toFixed(1)
        }
      ];

      // Colors matching Looker style: red, yellow, light blue, light green, brownish-red, orange, dark blue, dark green
      const colors = ['#ea4335', '#fbbc04', '#81d4fa', '#81c784', '#d32f2f', '#ff9800', '#1976d2', '#00796b'];
      const maxWidth = steps[0].last7Days.pct; // Use first step as base (100%)

      function formatNumber(num) {
        return num.toLocaleString();
      }

      return (
        <div className="chart-container">
          <div className="section-header" style={{ marginBottom: '16px' }}>
            <h3 style={{ fontSize: '18px', fontWeight: '600', marginBottom: '4px', color: '#333333' }}>Funnel breakdown</h3>
            <p style={{ fontSize: '13px', color: '#666666', fontStyle: 'italic' }}>* % of the previous step</p>
          </div>
          <div className="funnel-container">
            {steps.map((step, index) => {
              // Calculate width as percentage of first step (creates tapering effect)
              const widthPct = (step.last7Days.pct / maxWidth * 100);
              
              return (
                <div key={index} className="funnel-row">
                  <div className="funnel-label">{step.name}</div>
                  <div className="funnel-bar-container">
                    <div
                      className="funnel-bar"
                      style={{
                        backgroundColor: colors[index],
                        width: `${widthPct}%`,
                        minWidth: '200px'
                      }}
                    >
                      <span className="funnel-bar-percentage">{step.conversionPct}%</span>
                      <span className="funnel-bar-count">{formatNumber(step.last7Days.count)}</span>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      );
    }

    function TransactionSuccessRateChart() {
      const chartRef = useRef(null);
      const chartInstanceRef = useRef(null);

      useEffect(() => {
        const datasets = [
          {
            label: 'Last Year',
            data: transactionSuccessRateData.map(d => d.lastYear),
            borderColor: '#fbbc04',
            backgroundColor: 'transparent',
            borderWidth: 2,
            pointRadius: 3,
            pointHoverRadius: 4,
            pointBackgroundColor: '#fbbc04',
            pointBorderColor: '#ffffff',
            pointBorderWidth: 1.5,
            tension: 0
          },
          {
            label: 'This Year',
            data: transactionSuccessRateData.map(d => d.thisYear),
            borderColor: '#ea4335',
            backgroundColor: 'transparent',
            borderWidth: 2,
            pointRadius: 3,
            pointHoverRadius: 4,
            pointBackgroundColor: '#ea4335',
            pointBorderColor: '#ffffff',
            pointBorderWidth: 1.5,
            tension: 0
          }
        ];

        createChart(
          chartRef,
          chartInstanceRef,
          transactionSuccessRateData,
          transactionSuccessRateData.map(d => d.week),
          datasets,
          { title: 'Success Rate (%)', min: 98.8, max: 99.3, stepSize: 0.05 }
        );

        return () => {
          if (chartInstanceRef.current) {
            chartInstanceRef.current.destroy();
          }
        };
      }, []);

      return (
        <div className="apv-chart">
          <canvas ref={chartRef}></canvas>
        </div>
      );
    }

    function CheckoutSplitChart() {
      const chartRef = useRef(null);
      const chartInstanceRef = useRef(null);

      useEffect(() => {
        if (chartRef.current && typeof Chart !== 'undefined') {
          const ctx = chartRef.current.getContext('2d');
          
          if (chartInstanceRef.current) {
            chartInstanceRef.current.destroy();
          }

          // Calculate percentage point changes
          const addToCartChange = (checkoutSplitData.last7Days.addToCart - checkoutSplitData.lastYear.addToCart).toFixed(1);
          const bookNowChange = (checkoutSplitData.last7Days.bookNow - checkoutSplitData.lastYear.bookNow).toFixed(1);

          chartInstanceRef.current = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: ['This Year (Last 7 Days)'],
              datasets: [
                {
                  label: `Add to cart (${addToCartChange > 0 ? '+' : ''}${addToCartChange} p.p. YoY)`,
                  data: [checkoutSplitData.last7Days.addToCart],
                  backgroundColor: '#ea4335'
                },
                {
                  label: `Book now (${bookNowChange > 0 ? '+' : ''}${bookNowChange} p.p. YoY)`,
                  data: [checkoutSplitData.last7Days.bookNow],
                  backgroundColor: '#fbbc04'
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { 
                  display: true, 
                  position: 'bottom',
                  labels: {
                    font: { size: 13 },
                    padding: 16
                  }
                },
                tooltip: {
                  callbacks: {
                    label: function(context) {
                      return context.dataset.label.split(' (')[0] + ': ' + context.parsed.y.toFixed(1) + '%';
                    }
                  }
                }
              },
              scales: {
                x: { 
                  stacked: true,
                  ticks: { font: { size: 13 } }
                },
                y: { 
                  stacked: true,
                  max: 100,
                  ticks: { 
                    callback: function(value) { return value + '%'; },
                    font: { size: 13 }
                  }
                }
              }
            }
          });
        }

        return () => {
          if (chartInstanceRef.current) {
            chartInstanceRef.current.destroy();
          }
        };
      }, []);

      return (
        <div className="apv-chart">
          <canvas ref={chartRef}></canvas>
        </div>
      );
    }

    function LoginTypeChart() {
      const chartRef = useRef(null);
      const chartInstanceRef = useRef(null);

      useEffect(() => {
        if (chartRef.current && typeof Chart !== 'undefined') {
          const ctx = chartRef.current.getContext('2d');
          
          if (chartInstanceRef.current) {
            chartInstanceRef.current.destroy();
          }

          // Calculate percentage point changes
          const guestChange = (loginTypeData.last7Days.guest - loginTypeData.lastYear.guest).toFixed(1);
          const emailChange = (loginTypeData.last7Days.email - loginTypeData.lastYear.email).toFixed(1);
          const socialChange = (loginTypeData.last7Days.social - loginTypeData.lastYear.social).toFixed(1);

          chartInstanceRef.current = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: ['This Year (Last 7 Days)'],
              datasets: [
                {
                  label: `Guest checkout (${guestChange > 0 ? '+' : ''}${guestChange} p.p. YoY)`,
                  data: [loginTypeData.last7Days.guest],
                  backgroundColor: '#ea4335'
                },
                {
                  label: `Email (${emailChange > 0 ? '+' : ''}${emailChange} p.p. YoY)`,
                  data: [loginTypeData.last7Days.email],
                  backgroundColor: '#fbbc04'
                },
                {
                  label: `Social login (${socialChange > 0 ? '+' : ''}${socialChange} p.p. YoY)`,
                  data: [loginTypeData.last7Days.social],
                  backgroundColor: '#4285f4'
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { 
                  display: true, 
                  position: 'bottom',
                  labels: {
                    font: { size: 13 },
                    padding: 16
                  }
                },
                tooltip: {
                  callbacks: {
                    label: function(context) {
                      return context.dataset.label.split(' (')[0] + ': ' + context.parsed.y.toFixed(1) + '%';
                    }
                  }
                }
              },
              scales: {
                x: { 
                  stacked: true,
                  ticks: { font: { size: 13 } }
                },
                y: { 
                  stacked: true,
                  max: 100,
                  ticks: { 
                    callback: function(value) { return value + '%'; },
                    font: { size: 13 }
                  }
                }
              }
            }
          });
        }

        return () => {
          if (chartInstanceRef.current) {
            chartInstanceRef.current.destroy();
          }
        };
      }, []);

      return (
        <div className="apv-chart">
          <canvas ref={chartRef}></canvas>
        </div>
      );
    }

    function CouponUsageChart() {
      const chartRef = useRef(null);
      const chartInstanceRef = useRef(null);

      useEffect(() => {
        const datasets = [
          {
            label: 'Last Year',
            data: couponUsageData.map(d => d.lastYear),
            borderColor: '#fbbc04',
            backgroundColor: 'transparent',
            borderWidth: 2,
            pointRadius: 3,
            pointHoverRadius: 4,
            pointBackgroundColor: '#fbbc04',
            pointBorderColor: '#ffffff',
            pointBorderWidth: 1.5,
            tension: 0
          },
          {
            label: 'This Year',
            data: couponUsageData.map(d => d.thisYear),
            borderColor: '#ea4335',
            backgroundColor: 'transparent',
            borderWidth: 2,
            pointRadius: 3,
            pointHoverRadius: 4,
            pointBackgroundColor: '#ea4335',
            pointBorderColor: '#ffffff',
            pointBorderWidth: 1.5,
            tension: 0
          }
        ];

        createChart(
          chartRef,
          chartInstanceRef,
          couponUsageData,
          couponUsageData.map(d => d.week),
          datasets,
          { title: 'Share (%)', min: 12, max: 16, stepSize: 0.5 }
        );

        return () => {
          if (chartInstanceRef.current) {
            chartInstanceRef.current.destroy();
          }
        };
      }, []);

      return (
        <div className="apv-chart">
          <canvas ref={chartRef}></canvas>
        </div>
      );
    }

    function CheckoutToBookingSection() {
      return (
        <div className="discover-section">
          <div className="section-header">
            <h2>Checkout-to-booking conversion rate</h2>
            <div className="section-subtitle">
              <p>Last 12 weeks vs the same period last year.</p>
            </div>
          </div>
          <div className="chart-container">
            <CheckoutToBookingChart />
          </div>
        </div>
      );
    }

    function TwoChartsRow1() {
      return (
        <div className="discover-section">
          <div className="charts-row">
            <div className="chart-container">
              <div className="section-header" style={{ marginBottom: '16px' }}>
                <h3 style={{ fontSize: '18px', marginBottom: '8px' }}>Check availability to checkout breakdown</h3>
                <p style={{ fontSize: '14px', color: '#5f6368' }}>Last 12 weeks vs the same period last year.</p>
              </div>
              <CheckAvailabilityToCheckoutChart />
            </div>
            <div className="chart-container">
              <div className="section-header" style={{ marginBottom: '16px' }}>
                <h3 style={{ fontSize: '18px', marginBottom: '8px' }}>Payment page-to-booking conversion rate breakdown</h3>
                <p style={{ fontSize: '14px', color: '#5f6368' }}>Last 12 weeks vs the same period last year.</p>
              </div>
              <PaymentPageToBookingBreakdownChart />
            </div>
          </div>
        </div>
      );
    }

    function TwoChartsRow2() {
      return (
        <div className="discover-section">
          <div className="charts-row">
            <div className="chart-container">
              <VerticalFunnelChart />
            </div>
            <div className="chart-container">
              <div className="section-header" style={{ marginBottom: '16px' }}>
                <h3 style={{ fontSize: '18px', marginBottom: '8px' }}>Transaction lifecycle: Transaction End-to-End Success Rate</h3>
                <p style={{ fontSize: '14px', color: '#5f6368' }}>Last 12 weeks vs the same period last year.</p>
              </div>
              <TransactionSuccessRateChart />
            </div>
          </div>
        </div>
      );
    }

    function CheckoutTextMetrics() {
      return (
        <div className="chart-container">
          <div className="text-metrics-container">
            <div className="text-metric-item">
              <div className="text-metric-label">Share of logged-in checkouts</div>
              <div className="text-metric-value">{checkoutTextMetrics.loggedInCheckouts.last7Days.toFixed(1)}%</div>
              <div className="text-metric-yoy">
                YoY: {checkoutTextMetrics.loggedInCheckouts.lastYear.toFixed(1)}%
                <span className={`text-metric-change ${checkoutTextMetrics.loggedInCheckouts.change >= 0 ? 'positive' : 'negative'}`}>
                  ({checkoutTextMetrics.loggedInCheckouts.change > 0 ? '+' : ''}{checkoutTextMetrics.loggedInCheckouts.change.toFixed(1)}%)
                </span>
              </div>
            </div>
            <div className="text-metric-item">
              <div className="text-metric-label">Share of created accounts</div>
              <div className="text-metric-value">{checkoutTextMetrics.createdAccounts.last7Days.toFixed(1)}%</div>
              <div className="text-metric-yoy">
                YoY: {checkoutTextMetrics.createdAccounts.lastYear.toFixed(1)}%
                <span className={`text-metric-change ${checkoutTextMetrics.createdAccounts.change >= 0 ? 'positive' : 'negative'}`}>
                  ({checkoutTextMetrics.createdAccounts.change > 0 ? '+' : ''}{checkoutTextMetrics.createdAccounts.change.toFixed(1)}%)
                </span>
              </div>
            </div>
          </div>
        </div>
      );
    }

    function PaymentTermsChart() {
      const chartRef = useRef(null);
      const chartInstanceRef = useRef(null);

      useEffect(() => {
        if (chartRef.current && typeof Chart !== 'undefined') {
          const ctx = chartRef.current.getContext('2d');
          
          if (chartInstanceRef.current) {
            chartInstanceRef.current.destroy();
          }

          chartInstanceRef.current = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: paymentTermsData.map(d => d.week),
              datasets: [
                {
                  label: 'Pay now',
                  data: paymentTermsData.map(d => d.payNowTY),
                  backgroundColor: '#ea4335'
                },
                {
                  label: 'Pay later',
                  data: paymentTermsData.map(d => d.payLaterTY),
                  backgroundColor: '#ff9800'
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { display: true, position: 'bottom' },
                tooltip: {
                  callbacks: {
                    label: function(context) {
                      return context.dataset.label + ': ' + context.parsed.y.toFixed(1) + '%';
                    }
                  }
                }
              },
              scales: {
                x: { stacked: true },
                y: { 
                  stacked: true,
                  max: 100,
                  ticks: { callback: function(value) { return value + '%'; } }
                }
              }
            }
          });
        }

        return () => {
          if (chartInstanceRef.current) {
            chartInstanceRef.current.destroy();
          }
        };
      }, []);

      return (
        <div className="apv-chart">
          <canvas ref={chartRef}></canvas>
        </div>
      );
    }

    function PaymentMethodsChart() {
      const chartRef = useRef(null);
      const chartInstanceRef = useRef(null);

      useEffect(() => {
        if (chartRef.current && typeof Chart !== 'undefined') {
          const ctx = chartRef.current.getContext('2d');
          
          if (chartInstanceRef.current) {
            chartInstanceRef.current.destroy();
          }

          chartInstanceRef.current = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: paymentMethodsData.map(d => d.week),
              datasets: [
                {
                  label: 'Credit cards',
                  data: paymentMethodsData.map(d => d.creditCardsTY),
                  backgroundColor: '#ea4335'
                },
                {
                  label: 'Mobile wallets',
                  data: paymentMethodsData.map(d => d.mobileWalletsTY),
                  backgroundColor: '#fbbc04'
                },
                {
                  label: 'PayPal',
                  data: paymentMethodsData.map(d => d.paypalTY),
                  backgroundColor: '#4285f4'
                },
                {
                  label: 'Klarna',
                  data: paymentMethodsData.map(d => d.klarnaTY),
                  backgroundColor: '#e91e63'
                },
                {
                  label: 'Local APMs',
                  data: paymentMethodsData.map(d => d.localAPMsTY),
                  backgroundColor: '#34a853'
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { display: true, position: 'bottom', labels: { font: { size: 11 }, padding: 12 } },
                tooltip: {
                  callbacks: {
                    label: function(context) {
                      return context.dataset.label + ': ' + context.parsed.y.toFixed(1) + '%';
                    }
                  }
                }
              },
              scales: {
                x: { stacked: true },
                y: { 
                  stacked: true,
                  max: 100,
                  ticks: { callback: function(value) { return value + '%'; } }
                }
              }
            }
          });
        }

        return () => {
          if (chartInstanceRef.current) {
            chartInstanceRef.current.destroy();
          }
        };
      }, []);

      return (
        <div className="apv-chart">
          <canvas ref={chartRef}></canvas>
        </div>
      );
    }

    function PaymentMetricsSwimlane() {
      return (
        <div className="swimlane" style={{ gridTemplateColumns: 'repeat(6, 1fr)' }}>
          {paymentMetrics.map((metric, index) => (
            <div key={index} className="metric-card">
              <div className="metric-name">{metric.name}</div>
              <div className="metric-values">
                <div className="metric-main-value" style={{ fontVariantNumeric: 'tabular-nums' }}>{metric.lastWeek.toFixed(1)}%</div>
                <div className="metric-comparison">
                  <span className="metric-yoy">YoY: {metric.lastYear.toFixed(1)}%</span>
                  <span className={`metric-change ${metric.change >= 0 ? 'positive' : 'negative'}`}>
                    {metric.change > 0 ? '+' : ''}{metric.change.toFixed(1)}%
                  </span>
                </div>
              </div>
            </div>
          ))}
        </div>
      );
    }

    function ProcessorSuccessRateChart() {
      const chartRef = useRef(null);
      const chartInstanceRef = useRef(null);

      useEffect(() => {
        const datasets = [
          {
            label: 'Adyen',
            data: processorPerformanceData.successRate.map(d => d.adyenTY),
            borderColor: '#ea4335',
            backgroundColor: 'transparent',
            borderWidth: 2,
            pointRadius: 3,
            tension: 0
          },
          {
            label: 'Checkout',
            data: processorPerformanceData.successRate.map(d => d.checkoutTY),
            borderColor: '#fbbc04',
            backgroundColor: 'transparent',
            borderWidth: 2,
            pointRadius: 3,
            tension: 0
          },
          {
            label: 'JPMC',
            data: processorPerformanceData.successRate.map(d => d.jpmcTY),
            borderColor: '#4285f4',
            backgroundColor: 'transparent',
            borderWidth: 2,
            pointRadius: 3,
            tension: 0
          },
          {
            label: 'PayPal',
            data: processorPerformanceData.successRate.map(d => d.paypalTY),
            borderColor: '#34a853',
            backgroundColor: 'transparent',
            borderWidth: 2,
            pointRadius: 3,
            tension: 0
          },
          {
            label: 'Klarna',
            data: processorPerformanceData.successRate.map(d => d.klarnaTY),
            borderColor: '#ff9800',
            backgroundColor: 'transparent',
            borderWidth: 2,
            pointRadius: 3,
            tension: 0
          }
        ];

        createChart(
          chartRef,
          chartInstanceRef,
          processorPerformanceData.successRate,
          processorPerformanceData.successRate.map(d => d.week),
          datasets,
          { title: 'Success Rate (%)', min: 95, max: 98.5, stepSize: 0.5 }
        );

        return () => {
          if (chartInstanceRef.current) {
            chartInstanceRef.current.destroy();
          }
        };
      }, []);

      return (
        <div className="apv-chart">
          <canvas ref={chartRef}></canvas>
        </div>
      );
    }

    function ProcessorCostsChart() {
      const chartRef = useRef(null);
      const chartInstanceRef = useRef(null);

      useEffect(() => {
        const datasets = [
          {
            label: 'Adyen',
            data: processorPerformanceData.costs.map(d => d.adyenTY),
            borderColor: '#ea4335',
            backgroundColor: 'transparent',
            borderWidth: 2,
            pointRadius: 3,
            tension: 0
          },
          {
            label: 'Checkout',
            data: processorPerformanceData.costs.map(d => d.checkoutTY),
            borderColor: '#fbbc04',
            backgroundColor: 'transparent',
            borderWidth: 2,
            pointRadius: 3,
            tension: 0
          },
          {
            label: 'JPMC',
            data: processorPerformanceData.costs.map(d => d.jpmcTY),
            borderColor: '#4285f4',
            backgroundColor: 'transparent',
            borderWidth: 2,
            pointRadius: 3,
            tension: 0
          },
          {
            label: 'PayPal',
            data: processorPerformanceData.costs.map(d => d.paypalTY),
            borderColor: '#34a853',
            backgroundColor: 'transparent',
            borderWidth: 2,
            pointRadius: 3,
            tension: 0
          },
          {
            label: 'Klarna',
            data: processorPerformanceData.costs.map(d => d.klarnaTY),
            borderColor: '#ff9800',
            backgroundColor: 'transparent',
            borderWidth: 2,
            pointRadius: 3,
            tension: 0
          }
        ];

        createChart(
          chartRef,
          chartInstanceRef,
          processorPerformanceData.costs,
          processorPerformanceData.costs.map(d => d.week),
          datasets,
          { title: 'Costs (% of GMV)', min: 2.2, max: 3.4, stepSize: 0.1 }
        );

        return () => {
          if (chartInstanceRef.current) {
            chartInstanceRef.current.destroy();
          }
        };
      }, []);

      return (
        <div className="apv-chart">
          <canvas ref={chartRef}></canvas>
        </div>
      );
    }

    function CountriesTable() {
      return (
        <div className="countries-table-container">
          <table className="countries-table">
            <thead>
              <tr>
                <th>Country</th>
                <th>Payment Page Visits</th>
                <th>Payment Initiation Rate</th>
                <th>Payment Methods</th>
                <th>% Local APMs</th>
                <th>Payment Success Rate</th>
                <th>Attempt Success Rate</th>
                <th>Retries %</th>
                <th>Fraud Block Rate</th>
                <th>Share in GMV</th>
                <th>Costs % of GMV</th>
                <th>Dispute Rate</th>
                <th>Refunds Rate</th>
              </tr>
            </thead>
            <tbody>
              {topCountriesData.map((country, index) => {
                // Calculate max values for bar visualization
                const maxPaymentPageVisits = Math.max(...topCountriesData.map(c => c.paymentPageVisits));
                const maxGmvShare = Math.max(...topCountriesData.map(c => c.gmvShare));
                
                const paymentPageVisitsPct = (country.paymentPageVisits / maxPaymentPageVisits * 100);
                const gmvSharePct = (country.gmvShare / maxGmvShare * 100);
                
                return (
                  <tr key={index}>
                    <td className="country-name">{country.country}</td>
                    <td>
                      <div className="table-bar-cell">
                        <div className="table-bar-container">
                          <div className="table-bar-fill" style={{ width: `${paymentPageVisitsPct}%` }}></div>
                        </div>
                        <div className="table-bar-value">{formatNumber(country.paymentPageVisits)}</div>
                      </div>
                    </td>
                    <td>{country.paymentInitiationRate.toFixed(1)}%</td>
                    <td>{country.paymentMethods}</td>
                    <td>{country.localAPMsPct.toFixed(1)}%</td>
                    <td>{country.paymentSuccessRate.toFixed(1)}%</td>
                    <td>{country.attemptSuccessRate.toFixed(1)}%</td>
                    <td>{country.retriesPct.toFixed(1)}%</td>
                    <td>{country.fraudBlockRate.toFixed(1)}%</td>
                    <td>
                      <div className="table-bar-cell">
                        <div className="table-bar-container">
                          <div className="table-bar-fill" style={{ width: `${gmvSharePct}%` }}></div>
                        </div>
                        <div className="table-bar-value">{country.gmvShare.toFixed(1)}%</div>
                      </div>
                    </td>
                    <td>{country.costsPct.toFixed(1)}%</td>
                    <td>{country.disputeRate.toFixed(1)}%</td>
                    <td>{country.refundsRate.toFixed(1)}%</td>
                  </tr>
                );
              })}
            </tbody>
          </table>
        </div>
      );
    }

    function CheckoutBreakdownSection() {
      return (
        <div className="discover-section">
          <div className="section-header">
            <h2>Checkout breakdown</h2>
          </div>
          <div className="charts-row-checkout">
            <CheckoutTextMetrics />
            <div className="chart-container">
              <div className="section-header" style={{ marginBottom: '16px' }}>
                <h3 style={{ fontSize: '16px', marginBottom: '8px' }}>Split by Add to cart / Book now</h3>
                <p style={{ fontSize: '13px', color: '#666666' }}>Last 7 days + YoY percentage changes.</p>
              </div>
              <CheckoutSplitChart />
            </div>
            <div className="chart-container">
              <div className="section-header" style={{ marginBottom: '16px' }}>
                <h3 style={{ fontSize: '16px', marginBottom: '8px' }}>Split by login type</h3>
                <p style={{ fontSize: '13px', color: '#666666' }}>Last 7 days + YoY percentage changes.</p>
              </div>
              <LoginTypeChart />
            </div>
            <div className="chart-container">
              <div className="section-header" style={{ marginBottom: '16px' }}>
                <h3 style={{ fontSize: '16px', marginBottom: '8px' }}>Share of shopping carts with coupon/cash gift code</h3>
                <p style={{ fontSize: '13px', color: '#666666' }}>Last 12 weeks vs the same period last year.</p>
              </div>
              <CouponUsageChart />
            </div>
          </div>
        </div>
      );
    }

    function PaymentsBreakdownSection() {
      return (
        <div className="discover-section">
          <div className="section-header">
            <h2>Payments breakdown</h2>
          </div>
          <div className="charts-row">
            <div className="chart-container">
              <div className="section-header" style={{ marginBottom: '16px' }}>
                <h3 style={{ fontSize: '18px', marginBottom: '8px' }}>Split of initiated payments by payment terms</h3>
                <p style={{ fontSize: '14px', color: '#5f6368' }}>Pay now / Pay later. Last 12 weeks vs the same period last year.</p>
              </div>
              <PaymentTermsChart />
            </div>
            <div className="chart-container">
              <div className="section-header" style={{ marginBottom: '16px' }}>
                <h3 style={{ fontSize: '18px', marginBottom: '8px' }}>Split of initiated payments by payment method group</h3>
                <p style={{ fontSize: '14px', color: '#5f6368' }}>Last 12 weeks vs the same period last year.</p>
              </div>
              <PaymentMethodsChart />
            </div>
          </div>
        </div>
      );
    }

    function ProcessorPerformanceSection() {
      return (
        <div className="discover-section">
          <div className="section-header">
            <h2>Processor Performance</h2>
            <div className="section-subtitle">
              <p>Last 12 weeks vs the same period last year.</p>
            </div>
          </div>
          <div className="charts-row">
            <div className="chart-container">
              <div className="section-header" style={{ marginBottom: '16px' }}>
                <h3 style={{ fontSize: '18px', marginBottom: '8px' }}>Payment attempt success rate by processor</h3>
              </div>
              <ProcessorSuccessRateChart />
            </div>
            <div className="chart-container">
              <div className="section-header" style={{ marginBottom: '16px' }}>
                <h3 style={{ fontSize: '18px', marginBottom: '8px' }}>Payment costs as % of GMV by processor</h3>
              </div>
              <ProcessorCostsChart />
            </div>
          </div>
        </div>
      );
    }

    function TopCountriesSection() {
      return (
        <div className="discover-section">
          <div className="section-header">
            <h2>Top 20 Countries</h2>
            <div className="section-subtitle">
              <p>Last 7 days performance metrics.</p>
            </div>
          </div>
          <CountriesTable />
        </div>
      );
    }

    function Dashboard() {
      return (
        <div className="dashboard">
          <DashboardHeader />
          <Filters />
          <MainMetricsSwimlane />
          <CheckoutToBookingSection />
          <TwoChartsRow1 />
          <TwoChartsRow2 />
          <CheckoutBreakdownSection />
          <PaymentsBreakdownSection />
          <PaymentMetricsSwimlane />
          <ProcessorPerformanceSection />
          <TopCountriesSection />
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<Dashboard />);
  </script>
</body>
</html>
